/*! AeroGear JavaScript Library - v1.0.0.Alpha - 2012-08-24
* https://github.com/aerogear/aerogear-js
* JBoss, Home of Professional Open Source
* Copyright 2012, Red Hat, Inc., and individual contributors
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
* http://www.apache.org/licenses/LICENSE-2.0
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
(function(a,b){var c=a.aerogear={}})(this),function(a,b){function c(a){return{}.toString.call(a)==="[object Array]"}a.pipeline=function(b){var d={pipes:{},add:function(b){var d,e;if(!b)return this;if(typeof b=="string")this.pipes[b]=a.pipeline.adapters.rest(b,"id");else if(c(b))for(d=0;d<b.length;d++)e=b[d],typeof e=="string"?this.pipes[e]=a.pipeline.adapters.rest(e):this.pipes[e.name]=a.pipeline.adapters[e.type||"rest"](e.name,e.recordId||"id",e.settings||{});else this.pipes[b.name]=a.pipeline.adapters[b.type||"rest"](b.name,b.recordId||"id",b.settings||{});return this},remove:function(a){var b,d;if(typeof a=="string")delete this.pipes[a];else if(c(a))for(b=0;b<a.length;b++)d=a[b],typeof d=="string"?delete this.pipes[d]:delete this.pipes[d.name];else a&&delete this.pipes[a.name];return this}};return d.add(b)},a.pipeline.adapters={}}(aerogear),function(a,b,c){function d(a){return{}.toString.call(a)==="[object Array]"}a.pipeline.adapters.rest=function(a,c,e){return e=b.extend({url:a,contentType:"application/json",dataType:"json"},e),{recordId:c,type:"rest",data:null,read:function(a){var c=this,f;a?(a.ajax&&a.ajax.data?f=a.ajax.data:a.data?f=a.data:a.ajax||(a.ajax={}),f&&(a.ajax.data=f)):a={ajax:{}};var g=function(b){c.data=d(b)?b:[b],a.ajax.success&&a.ajax.success.apply(this,arguments)};return b.ajax(b.extend({},e,{type:"GET"},a.ajax,{success:g}))},save:function(a,c){var f=this,g,h,i=!1;a=a||{},c=c||{},g=a[this.recordId]?"PUT":"POST",!c.ajax.url&&a[this.recordId]?h=e.url+"/"+a[this.recordId]:c.ajax.url?h=c.ajax.url:h=e.url;var j=function(a){if(f.data){for(var b in f.data)f.data[b].id===a.id&&(f.data[b]=a,i=!0);i||f.data.push(a)}else f.data=d(a)?a:[a];c.ajax.success&&c.ajax.success.apply(this,arguments)};return typeof a!="string"&&(a=JSON.stringify(a)),b.ajax(b.extend({},e,{data:a,type:g,url:h},c.ajax||{},{success:j}))},remove:function(a,c){var d=this,f=0,g="",h;c=c||{};if(typeof a=="string"||typeof a=="number")f=parseInt(a,10);else if(a)typeof a.record=="string"||typeof a.record=="number"?f=parseInt(a.record,10):a.record&&(f=parseInt(a.record[this.recordId],10));else throw"aerogear.pipeline.rest: missing argument";g=f?"/"+f:"",c.ajax?c.ajax.url?h=c.ajax.url:h=e.url+g:a.ajax?(c.ajax=a.ajax,a.ajax.url?h=a.ajax.url:h=e.url+g):h=e.url+g;var i=function(a){var b;for(var e in d.data)d.data[e].id===f&&d.data.splice(e,1);c.ajax.success&&c.ajax.success.apply(this,arguments)};return b.ajax(b.extend({},e,{type:"DELETE",url:h},c.ajax||{},{success:i}))},filter:function(a,b){var c,d;return a?(c=this.data.filter(function(c,e,f){var g=b?!1:!0,h=Object.keys(a);for(d=0;d<h.length;d++){if(b&&a[h[d]]===c[h[d]]){g=!0;break}if(!b&&a[h[d]]!==c[h[d]]){g=!1;break}}return g}),c):(c=this.data||[],c)}}}}(aerogear,jQuery);